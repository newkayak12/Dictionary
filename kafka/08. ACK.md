## 8. acks란?

### 개념

- Producer가 메시지를 전송한 후 **언제 성공으로 간주할지** 결정하는 설정
- **신뢰성 vs 성능**의 Trade-off를 조절하는 핵심 파라미터
- Broker로부터 받는 **응답(acknowledgment) 정책**

### 메시지 전달 보장(Delivery Guarantees)
- **At-least-once**: 중복 가능, 손실 없음
- **At-most-once**: 손실 가능, 중복 없음
- **Exactly-once**: Idempotent + Transaction
### acks 옵션

- **acks=0**: 응답 대기 안함 (Fire-and-forget)
- **acks=1**: Leader만 응답하면 성공
- **acks=all(-1)**: 모든 ISR이 응답해야 성공

### 각 옵션의 특성

**acks=0 (최고 성능)**

- Producer가 전송 즉시 성공으로 간주
- 네트워크/Broker 장애 시 메시지 손실 가능
- 최고 처리량, 최저 지연시간

**acks=1 (기본값, 균형)**

- Leader Partition에 저장되면 성공 응답
- Leader 장애 시 Follower 동기화 전이면 손실 가능
- 성능과 안정성의 균형점

**acks=all (최고 안정성)**

- 모든 ISR Replica가 메시지 저장해야 성공
- 가장 안전하지만 지연시간 증가
- min.insync.replicas와 함께 사용

---

### **1. acks=all 최적화**

- **min.insync.replicas=2**: 최소 ISR 수 보장
- **ISR < min.insync.replicas**: NotEnoughReplicas 예외
- **replication.factor=3, min.insync.replicas=2**: 일반적 설정

### **2. 메시지 전달 보장 수준**

- **At Most Once**: acks=0, 중복 없음/손실 가능
- **At Least Once**: acks=all + retry, 중복 가능/손실 없음
- **Exactly Once**: Idempotent + Transaction

### **3. 성능 임팩트 분석**

```
acks=0:    100% 처리량, 0% 안정성
acks=1:    90% 처리량, 90% 안정성  
acks=all:  70% 처리량, 99.9% 안정성
```

### **4. Idempotent Producer**

- **enable.idempotence=true**: 중복 방지
- **자동 설정**: acks=all, retries=MAX, max.in.flight=5
- **Sequence Number**: 중복 메시지 감지

### **5. 재시도 전략**

- **retries**: 재시도 횟수 (기본값 MAX)
- **retry.backoff.ms**: 재시도 간격 (기본 100ms)
- **delivery.timeout.ms**: 전체 전송 타임아웃

### **6. 실무 권장 설정**

- **일반 서비스**: acks=1, retries=3
- **중요 데이터**: acks=all, enable.idempotence=true
- **로그 수집**: acks=0, 성능 최우선

### **7. 모니터링 포인트**

- **Failed Send Rate**: 전송 실패율
- **Retry Rate**: 재시도 비율
- **Request Latency**: 응답 대기시간
- **Error Rate by Type**: 오류 유형별 분석