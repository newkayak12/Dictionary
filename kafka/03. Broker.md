## 3. Broker란?

### 개념
- Kafka **서버 인스턴스**
- 실제로 메시지를 **저장하고 전달**하는 물리적 서버
- 여러 Broker가 모여서 **Kafka Cluster** 구성

### 역할

- **Partition 저장**: 각 Broker가 여러 Partition 보관
- **Client 요청 처리**: Producer/Consumer 요청 응답
- **Replication 관리**: Partition 복제본 동기화

### Cluster 내 분산

- 각 Topic의 Partition들이 여러 Broker에 분산 저장
- 한 Broker 장애 시에도 다른 Broker에서 서비스 계속
- **Broker ID**로 각 서버 구분 (0, 1, 2, ...)

### Controller Broker

- Cluster 내 **하나의 Broker가 Controller 역할**
- Partition Leader 선출, Metadata 관리 담당
- Controller 장애 시 다른 Broker가 자동으로 Controller 


---

### **1. Broker 수 결정**

- **최소 3대**: 장애 허용을 위한 홀수 구성
- **Replication Factor**: 보통 3, Broker 수보다 작아야 함
- **가용영역 분산**: 물리적 장애 대비 AZ별 배치

### **2. 하드웨어 스펙**

- **CPU**: Producer/Consumer 연결 수에 비례
- **Memory**: Page Cache 최대화 (32GB+ 권장)
- **Disk**: SSD 권장, RAID 구성으로 안정성 확보
- **Network**: 10Gbps+ 고대역폭 필수

### **3. Partition 배치 전략**

- **Leader 분산**: 각 Broker가 고르게 Leader 역할
- **Rack Awareness**: 동일 랙 장애 대비 분산 배치
- **Hot Spot 방지**: 인기 Topic의 Partition 고른 분산

### **4. 확장 전략**

- **Scale Up**: 기존 Broker 스펙 업그레이드
- **Scale Out**: Broker 추가 후 Partition 재배치
- **Rolling Restart**: 무중단 업그레이드 패턴

### **5. 장애 복구**

- **Unclean Leader Election**: 데이터 손실 vs 가용성 선택
- **Min ISR**: 최소 동기화 Replica 수 보장
- **Auto Recovery**: 자동 복구 vs 수동 개입 전략