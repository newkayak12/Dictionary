## 6. Producer란?

###개념

- Kafka에 **메시지를 발행하는** 클라이언트
- Topic의 특정 Partition에 **메시지를 전송**하는 역할
- 다양한 언어로 구현된 **Kafka Client Library** 사용

### 메시지 전송 과정

- **Serialize**: 객체를 바이트 배열로 변환
- **Partition 선택**: Key 기반 또는 Round-Robin
- **Batch 수집**: 효율성을 위해 메시지를 모음
- **전송**: Broker에 배치 단위로 전송

### Partitioner 동작

- **Key 있음**: hash(key) % partition_count
- **Key 없음**: Sticky Partitioning (Round-Robin 개선)
- **Custom Partitioner**: 비즈니스 로직에 맞는 분배

### 응답 처리

- **Fire-and-Forget**: 전송 후 응답 무시
- **Synchronous**: send().get()로 응답 대기
- **Asynchronous**: Callback으로 응답 처리

---

### **1. Batching 최적화**

- **batch.size**: 배치 크기 (기본 16KB)
- **linger.ms**: 배치 대기 시간 (기본 0ms)
- **buffer.memory**: Producer 버퍼 크기 (기본 32MB)

### **2. 압축 설정**

- **compression.type**: gzip, snappy, lz4, zstd
- **snappy**: 낮은 CPU, 적당한 압축률 (일반적)
- **lz4**: 매우 빠름, 실시간 처리용

### **3. 처리량 vs 지연시간**

- **고처리량**: batch.size↑, linger.ms↑, compression 사용
- **저지연**: batch.size↓, linger.ms=0, 압축 없음
- **acks=1**: 처리량과 안정성의 균형점

### **4. 메모리 관리**

- **max.block.ms**: 버퍼 가득찰 때 대기시간
- **delivery.timeout.ms**: 전체 전송 타임아웃
- **request.timeout.ms**: 단일 요청 타임아웃

### **5. 파티션 전략**

- **균등 분산**: Key 없이 전송으로 고른 분배
- **순서 보장**: 동일 Key로 특정 Partition 고정
- **Hot Partition 회피**: Custom Partitioner로 부하 분산

### **6. Error Handling**

- **Retries**: 재시도 횟수 설정
- **Idempotent**: 중복 방지를 위한 멱등성
- **Dead Letter Topic**: 실패 메시지 별도 처리