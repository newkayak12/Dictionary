### 개념

- **Key별 최신 값만 유지**하는 저장소 최적화 방식
- 동일 Key의 오래된 메시지를 **자동 삭제**
- **상태 기반 데이터**를 효율적으로 저장하는 메커니즘

### Retention vs Compaction

**Time-based Retention (기본값)**

```
7일 후 모든 메시지 삭제
메시지 순서: A, B, C, D → 시간 지나면 전부 삭제
```

**Log Compaction**

```
Key별 최신 메시지만 보관
user1: create, update, update → 마지막 update만 남김
user2: create, delete → delete만 남김 (tombstone)
```

### 언제 사용하는가?

- **사용자 프로필**: 최신 상태만 필요
- **설정 정보**: 현재 설정값만 의미 있음
- **재고 현황**: 현재 수량이 중요
- **Event Sourcing**: 상태 재구성용 스냅샷

### Compaction 과정

- **Log Cleaner**: 백그라운드에서 주기적 실행
- **Active Segment**: 현재 쓰기 중인 Segment는 Compaction 안됨
- **Head vs Tail**: Head(최신) 유지, Tail(오래된) 정리