### 개념

- **정의**: 분산 시스템에서 데이터 변경 후 일정 시간이 지나면 모든 노드가 동일한 상태로 수렴하는 일관성 모델
- **핵심 특징**: 즉시 일관성을 보장하지 않지만, 시간이 지나면 결국 모든 복제본이 같은 값을 가지게 됨
- **CAP 이론 맥락**: Availability와 Partition tolerance를 우선시하면서 Consistency를 일시적으로 희생하는 전략
>
>**CAP 이론이란?**
>
> 기본 개념
>
> - **정의**: 분산 시스템에서 Consistency, Availability, Partition tolerance 중 최대 2개만 동시에 보장할 수 있다는 이론
> - **Consistency**: 모든 노드가 동시에 같은 데이터를 보는 것
> - **Availability**: 시스템이 항상 응답을 반환하는 것
> - **Partition tolerance**: 네트워크 분할이 발생해도 시스템이 계속 동작하는 것
>
> 실무 선택지
>
> - **CP (Consistency + Partition tolerance)**: 일관성 우선, 가용성 희생 → MongoDB, HBase
> - **AP (Availability + Partition tolerance)**: 가용성 우선, 일관성 희생 → Cassandra, DynamoDB
> - **CA**: 이론적으로만 존재 (네트워크 분할은 항상 발생 가능하므로)

### 동작 원리

- **비동기 전파**: 데이터 변경이 비동기적으로 다른 노드들에 전파됨
- **수렴 보장**: 네트워크 문제가 해결되고 충분한 시간이 주어지면 모든 노드가 동일한 상태로 수렴
- **중간 상태 허용**: 일시적으로 노드마다 다른 값을 가질 수 있음

---

#### 설계 고려사항

- **수렴 시간 설계**: 비즈니스 요구사항에 따른 허용 가능한 불일치 시간 정의
- **충돌 해결 전략**: Last-Write-Wins, Vector Clock, Conflict-free Replicated Data Types(CRDT) 등
- **모니터링 전략**: 복제 지연 시간, 불일치 발생 빈도 추적

## 충돌 해결 전략이란?

### 기본 개념

- **발생 상황**: 같은 데이터를 여러 노드에서 동시에 수정할 때 발생하는 불일치
- **목적**: 분산 환경에서 데이터 충돌을 자동으로 해결하는 메커니즘

> **주요 전략들**
>
> Last-Write-Wins (LWW)
>
> - **원리**: 가장 최근 타임스탬프를 가진 데이터가 승리
> - **장점**: 단순하고 빠름
> - **단점**: 데이터 손실 가능성
> - **실무 사례**: Redis, Cassandra 기본 설정
>
> Vector Clock
>
> - **원리**: 각 노드가 논리적 시계를 유지하여 인과관계 추적
> - **장점**: 데이터 손실 없음
> - **단점**: 복잡성 증가, 메타데이터 오버헤드
> - **실무 사례**: Riak, Voldemort
>
> CRDT (Conflict-free Replicated Data Types)
> 
> - **원리**: 수학적으로 충돌이 발생하지 않는 데이터 구조 사용
> - **장점**: 자동 병합, 충돌 없음
> - **단점**: 제한된 데이터 타입
> - **실무 사례**: Redis Sets, 협업 도구(Google Docs)


#### 실무 적용 영역

- **Kafka**: 파티션 간 메시지 순서, Consumer Group 리밸런싱 후 일관성
- **Redis Cluster**: 마스터-슬레이브 복제, 네트워크 파티션 시나리오
- **MSA**: 서비스 간 데이터 동기화, Event Sourcing, Saga 패턴
- **NoSQL**: Cassandra, DynamoDB 등의 기본 일관성 모델

#### 트레이드오프

- **장점**: 높은 가용성, 성능, 확장성
- **단점**: 일시적 불일치, 복잡한 애플리케이션 로직, 사용자 경험 고려 필요