### 개념

- Topic을 여러 개로 나눈 **물리적 저장 단위**
- 각 Partition은 독립적인 **순차 로그 파일**
- Broker의 디스크에 실제 파일로 저장됨

### 왜 나누는가?

- **병렬 처리**: 여러 Consumer가 동시에 다른 Partition 읽기 가능
- **확장성**: Partition 추가 = 처리 능력 증가
- **부하 분산**: 여러 Broker에 Partition 분산 배치

### 순서 보장의 범위

- **Partition 내부**: 메시지 순서 엄격히 보장
- **Partition 간**: 순서 보장 안됨
- **Global 순서** 필요하면 Partition 1개만 사용 (성능 포기)

### Partition과 Consumer의 관계

- **1:1 매핑**: 하나의 Partition은 Consumer Group 내 하나의 Consumer만
- **Partition 수 = 최대 Consumer 수**
- Consumer가 Partition보다 많으면 놀고 있는 Consumer 발생

---

### **1. Partition 수 결정 기준**

- **처리량 목표**: 초당 처리할 메시지 수
- **Consumer 수**: Partition 수 = 최대 Consumer 수
- **Broker 수**: 각 Broker에 고르게 분산
- **순서 보장 요구사항**: 글로벌 순서 필요 시 1개

### **2. 계산 공식**
```
필요 Partition 수 = max( 
  목표 처리량 / Consumer당 처리량,
  목표 처리량 / Producer당 처리량
)
```

### **3. Partition 수와 성능**

- **적을 때**: 병렬 처리 제한, 처리량 부족
- **많을 때**: 메타데이터 오버헤드, Rebalancing 비용 증가
- **적정선**: Broker 수 × 2~4배

### **4. Hot Partition 방지**

- **균등 분산**: Key 설계로 특정 Partition 과부하 방지
- **Null Key**: Round-Robin으로 고른 분산
- **Custom Partitioner**: 비즈니스 로직에 맞는 분배

### **5. Partition 증설 시 주의사항**

- **기존 데이터 재분배 안됨**: 불균형 해결 못함
- **Offset 무효화**: 기존 Consumer Offset 의미 없어짐
- **Key-based 순서 깨짐**: 기존 메시지 순서 보장 파괴
- **성능 영향 없음**: 기존 Hot Partition 문제 지속
- **감소 불가**: Partition 수는 늘리기만 가능
- **초기 설계 중요**: 충분한 여유를 두고 시작 필요