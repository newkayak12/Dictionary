## 2. Offset이란?

### 개념

- 각 Partition 내 메시지의 **고유 순번**
- 0부터 시작해서 순차 증가하는 **불변 값**
- 메시지 삭제되어도 Offset은 재사용 안됨

### Consumer Offset

- Consumer가 **어디까지 읽었는지** 표시하는 포인터
- `__consumer_offsets` Topic에 저장
- Consumer 재시작 시 마지막 읽은 위치부터 재개

### Offset Commit

- Consumer가 "여기까지 처리했다"고 Kafka에 알리는 행위
- **Auto Commit**: 주기적으로 자동 커밋
- **Manual Commit**: 처리 완료 후 수동 커밋

### Current Offset vs Committed Offset

- **Current**: Consumer가 현재 읽고 있는 위치
- **Committed**: Kafka에 저장된 마지막 처리 완료 위치
- 장애 시 Committed Offset부터 재시작

---

### **1. Commit 전략**

- **Auto Commit**: 주기적 자동 커밋, 메시지 손실/중복 가능
- **Manual Commit**: 처리 완료 후 수동 커밋, 정확성 보장 ✅
- **Batch Commit**: 여러 메시지 처리 후 일괄 커밋

### **2. Reset Policy**

- **earliest**: 가장 오래된 메시지부터
- **latest**: 가장 최신 메시지부터
- **none**: Consumer Group 정보 없으면 예외

### **3. Offset 관리 이슈**

- **Duplicated Processing**: Commit 전 Consumer 장애 시 중복 처리
- **Message Loss**: Commit 후 처리 실패 시 메시지 손실
- **Exactly-Once**: Transactional API로 정확히 한 번 처리

### **4. Monitoring 포인트**

- **Consumer Lag**: Current Offset과 최신 Offset 차이
- **Commit Rate**: 초당 Commit 횟수
- **Reset 빈도**: 비정상적인 Reset 발생 모니터링