# 분산락

## MySQL NamedLock

- GET_LOCK(String, timeout)
입력받은 이름으로 잠금을 획득한다. 
  - 1: 잠금 획득 성공
  - 0: 잠금 획득 실패
  - null: 에러 발생

- RELEASE_LOCK(String)
입력받은 이름의 잠금을 해제
  - 1: 잠금 해제 성공
  - 0: 잠금 해제 실패
  - null: 에러

>
> - IS_FREE_LOCK(String)
> 잠금 획득이 가능한지 확인
>   - 1: 잠금을 얻을 수 있을 떄
>   - 0: 잠금을 얻을 수 없을 때
>   - null: 에러 발생
> 
> - IS_USED_LOCK(String)
> 잠금이 사용 중인지 확인
> 존재하면 connection_id 반환


근데, 같은 트랜잭션에 쿼리를 던지면 새로운 동시성 문제가 발생한다.
여기서 트랜잭션을 분리할 수도 있지만 그러면 커넥션 풀이 순간적으로 튈 수 있다.

## Zookeeper
분산 시스템을 위한 일관된 서비스를 제공하는 오픈 소스 프로젝트로, 분산락 구현에 자주 사용된다.
분산 시스템 간의 정보 공유, 상태 체크, 서버들 간의 동기화를 위한 락 등을 처리해주는 서비스

[참고문헌] ( https://bcho.tistory.com/1016 )


## Redis
`set if not exists` 명령어와 같은 원자적 연산을 이용해서 분산락을 구현할 수 있다.


# Lock
락은 공유 자원에 대한 동시 접근을 제어하는 메커니즘이다. 락을 사용하면 한 번에 하나의 쓰레드만 해당 자원에 접근하거나 변경할 수 있다.


# Spin Lock
멀티스레딩 환경에서 공유 자원에 대한 동시 접근을 방지하기 위한 락 주앟나다.
다른 락과 다르게 락을 획득할 때까지 계속해서 락 획득을 시도하고 조건을 확인하면서 대기하는 기법이다.

- 장점
  - context switch가 발생하지 않음
- 단점
  - 리소스 낭비
  - 우선순위 역전 ( 락 대기로 낮은 우선순위 작업이 블록될 수 있음 )
