# 스케일링을 고려한 아키텍쳐

## Scaling
- 성능 저하 없이 더 많은 요청을 처리할 수 있도록 리소스를 확장하는 과정을 의미
- 데이터 처리량의 증가에 대비해 확장 가능한 아키텍쳐를 설계하는 것이 중요
- 클라우드 네이티브의 장점으로 클라우드 네이티브 아키텍쳐는 마이크로 서비스, 컨테이너, 오토스케일링을 통해 자동으로 확장성을 제공한다.

  1. 수직: 스펙업
  2. 수평: 서버 개수 증가


## Scaling을 고려한 시스템 아키텍처 설계 원칙
1. 유연성: 확장 가능성을 고려한 모듈화된 아키텍쳐 설계가 필요하다.
2. 복원력: 확장 과정에서 장애를 방지하고, 시스템이 자동으로 복구할 수 있도록 설계한다.
3. 확장 가능한 데이터 관리: 데이터 일관성을 유지하면서 여러 서버 간에 데이터를 효율적으로 분산하는 방법을 고려

## AutoScaling 전략
1. AWS Auto Scaling: EC2 인스턴스나 컨테이너 수를 트래픽 및 리소스 사용량에 따라 자동으로 조정
2. Kubernetes HPA(Horizontal Pod Autoscaler): 
   - HPA는 Kubernetes에서 Pod의 수를 자동으로 조절하는 기능
   - 클러스터 내에서 리소스 사용량에 따라 Pod의 수를 증가 또는 감소시켜 애플리케이션 성능을 유지
> ### 고려 사항
> - 임계값 설정: 자원을 확장하는 기준이 되는 메트릭의 임계 값을 적절하게 설정해야 한다.
> - 트리거: 스케일링 유발 트리거를 설정해야 한다.
> - 자동화와 모니터링: 자동으로 확장되도록 설정했더라도, 시스템이 예상대로 작동하는지 모니터링이 필요
> - 비용 관리: 오토스케일링은 편리하지만 과도한 리소스 확장은 비용 문제로 돌아올 수 있다.
> - 오토스케일링을 통한 비용 최적화 전략
>   - 온디맨드 리소스와 리저브드 인스턴스를 혼합
>   - 자동화 도구로 피크/ 비피크 시간대를 고려한 스케쥴링


## 로드밸런싱
- 대규모 트래픽이 발생할 때 서버 하나가 감당할 수 없는 부하가 생기지 않도록 트래픽을 여러 서버에 분산시켜 성능을 최적화한다.
- 여러 서버에 분산해서 안정성, 성능을 유지시키는 중요 기술
- 트래픽 집중을 방지하고 장애 시에도 트래픽을 다른 서버로 자동 분산할 수 있다.

### ELB(AWS Elastic Load Balancer)
- AWS 네트워크 계층에서 동작하는 로드 밸런서
- 여러 EC2 인스턴스에 트래픽을 균등하게 분산
- 모든 네트워크 트래픽을 분산시키며, 네트워크 레벨에서 작동

### ALB(Application Load Balancer)
- ALB는 애플리케이션 계층에서 동작하는 로드밸런서
- 주로 HTTP, HTTPS 트래픽을 처리
- 경로기반, 호스트 기반 라우팅으로 특정 트래픽을 특정 애플리케이션으로 정확하게 분배
- Websocket 지원 등 애플리케이션 레벨의 추가 기능을 제공

> ### ELB vs. ALB
> - ELB는 네트워크 계층에서 모든 트래픽을 분산
> - ALB는 애플리케이션 계층에서 HTTP/HTTPS를 주로 처리
> 
> ### 안정성을 유지하는 방법
> - 세션 유지
> - 성능 모니터링
> - 다중 리전 로드 밸런식
> 
> ### 네트워크 최적화, 트래픽 분산 시 추가 고려 사항
> - 지리적 분산: CDN 등과 함께 사용
> - 로드밸런서 상태 체크: 서버 상태를 주기적으로 확인해서 비정상 서버로 트래픽이 라우팅되지 않도록 한다.


## 캐싱 전략
- 캐싱은 데이터, 계산 결과를 미리 저장해 두었다가 나중에 동일한 요청이 들어올 때 빠르게 응답하기 위한 기술
- 캐싱 전략을 사용하면 응답속도를 향상시킬 수 있으며, API 응답이나 반복적인 데이터 조회에 유용
### 종류
- REDIS
- Memcached

### 인기있는 캐싱 전략 및 데이터 일관성 관리
1. LRU(Least Recently Used) 전략: 오래 사용하지 않은 데이터를 우선적으로 삭제해서 캐시 공간을 확보
2. 캐시 무효화: 데이터 변경 시, 캐시된 오래된 데이터를 무효화하고 새로운 데이터로 대체하는 방법
3. 캐시 계층 설계 
   - 캐시 계층을 설계할 때 만료 정책과 데이터 일관성을 고려해야한다.
   - 너무 오래된 캐시가 있다면 데이터 불일치 문제가 발생할 수 있따.
   - TTL(Time To Live): 유효 기간을 설정해서 일정 기간이 지나면 자동으로 삭제되도록한다.
   - 다중 계층 캐싱(Multi-layer Caching): 데이터를 효율적으로 저장하고 빠르게 접근하기 위해서 여러 단계의 캐시 시스템을 이용하는 것


> ### 로드밸런싱
> - 크기가 작을 떄: 
>   - 고정 트래픽 분산: 간단한 로드밸런싱으로 충분히 성능을 보장할 수 있다. (ALB, ELB 설정 정도로 충분히 대응 가능)
> - 크기가 커지면:
>   - 지리적 분산, 다중 리전 지원: 트래픽이 많아지면, 로드밸런서가 더 복잡해지고 고급 기능이 필요해진다. (CDN, Anycast 네트워크 활용)
>
> ### 캐싱 전략
> - 크기가 작을 떄:
>   - 간단한 캐싱 적용
> - 크기가 커지면
>   - 다중 계층 캐싱 도입: 트래픽이 늘어나면, 다중 계층 캐싱을 통해 성능 극대화한다.
>   - 서버 간의 캐시 분산을 적용하고, 데이터 일관성을 유지하기 위한 복잡한 캐시 전략을 도입

