# Others

## Shared vs. Exclusive

1. Shared(rw-lock)
- Shared는 읽기 락(ReadLock)이라고도 불린다.
- SELECT 만 가능하며, 쓰기 연산은 불가능해진다.
- 다른 트랜잭션도 공유 락을 획득할 수 있으나, 베타 락은 획득할 수 없다.
- 즉, 읽기는 다른 트랜잭션도 가능하다는 소리다.

2. Exclusive(mutex)
- Exclusive는 읽기 락(WriteLock)이라고도 불린다.
- 읽기, 쓰기 모두 수행할 수 없다.
- 다른 트랜잭션에서 공유, 베타락 모두 획득이 불가해진다.
- 즉, 데이터에 대한 독점권을 갖는다는 의미가 된다.

### one more things

3. latch
- DB 내무 메모리 구조에 대한 락을 구현하기 위해서 사용되는 경략 구조의 락
- 마이크로초 단위의 짧은 시간동안 유지된다.
- mutex(배타적 접근), rw-locks(공유 접근)을 포함하는 일반 용어



## engine status

[참고](https://m.blog.naver.com/jhisprophet/221354302894)
```mysql
show engine innodb status;
-- 
-- =====================================
-- 2024-08-02 02:30:31 0x154ee686b700 INNODB MONITOR OUTPUT
-- =====================================
-- Per second averages calculated from the last 41 seconds
-- -----------------
-- BACKGROUND THREAD
-- -----------------
-- srv_master_thread loops: 6408736 srv_active, 0 srv_shutdown, 11080 srv_idle
-- srv_master_thread log flush and writes: 6419816
--     ----------
--     SEMAPHORES
--     ----------
--     OS WAIT ARRAY INFO: reservation count 2290853
--     OS WAIT ARRAY INFO: signal count 18393055
--     RW-shared spins 0, rounds 6972195, OS waits 242137
--     RW-excl spins 0, rounds 21140103, OS waits 907806
--     RW-sx spins 91, rounds 2640, OS waits 63
--     Spin rounds per wait: 6972195.00 RW-shared, 21140103.00 RW-excl, 29.01 RW-sx
--     ------------------------
--     LATEST FOREIGN KEY ERROR
--     ------------------------
--     2024-08-01 09:24:08 0x154f088ef700 Transaction:
--     TRANSACTION 10032734, ACTIVE 0 sec inserting
--     mysql tables in use 1, locked 1
--     3 lock struct(s), heap size 1136, 1 row lock(s), undo log entries 1
-- MySQL thread id 86146, OS thread handle 23429190186752, query id 5766853093 172.31.0.246 admin update
--                                                   insert into `UnionGlobal`.`tblUserAddress` (`userNo`, `addressName`, `addressDetail`, `longitude`, `latitude`) values (0, '집', '비스타 써머셋 써머셋2502호', '106.684896', '10.807135')
--                                                   Foreign key constraint fails for table `UnionGlobal`.`tblUserAddress`:
--                                                       ,
--                                                   CONSTRAINT `tblUserAddress_tblUser_userNo_fk` FOREIGN KEY (`userNo`) REFERENCES `tblUser` (`userNo`) ON DELETE CASCADE ON UPDATE CASCADE
--     Trying to add in child table, in index tblUserAddress_tblUser_userNo_fk tuple:
--     DATA TUPLE: 2 fields;
-- 0: len 8; hex 8000000000000000; asc         ;;
-- 1: len 8; hex 800000000000102c; asc        ,;;
-- 
-- But in parent table `UnionGlobal`.`tblUser`, in index PRIMARY,
-- the closest match we can find is record:
-- PHYSICAL RECORD: n_fields 18; compact format; info bits 0
--  0: len 8; hex 8000000000000001; asc         ;;
-- 1: len 6; hex 000000991486; asc       ;;
-- 2: len 7; hex 2a000002ca249b; asc *    $ ;;
-- 3: len 6; hex 61646d696e31; asc admin1;;
-- 4: len 30; hex 243261243130246a63437249713848486f6f302f687635544d517a546566; asc $2a$10$jcCrIq8HHoo0/hv5TMQzTef; (total 60 bytes);
-- 5: len 7; hex 47454e4552414c; asc GENERAL;;
-- 6: len 15; hex 486f20436869204d696e682e205137; asc Ho Chi Minh. Q7;;
-- 7: SQL NULL;
-- 8: SQL NULL;
-- 9: len 6; hex 414354495645; asc ACTIVE;;
-- 10: len 2; hex 4b4f; asc KO;;
-- 11: len 1; hex 01; asc  ;;
-- 12: len 1; hex 01; asc  ;;
-- 13: len 1; hex 01; asc  ;;
-- 14: len 5; hex 99b0d2aacc; asc      ;;
-- 15: len 5; hex 99b3fca277; asc     w;;
-- 16: len 5; hex 99b0d2aacc; asc      ;;
-- 17: len 0; hex ; asc ;;
-- 
-- ------------------------
-- LATEST DETECTED DEADLOCK
-- ------------------------
-- 2024-07-05 10:53:15 0x154ec46ef700
-- *** (1) TRANSACTION:
-- TRANSACTION 8936250, ACTIVE 0 sec starting index read
-- mysql tables in use 1, locked 1
-- LOCK WAIT 2 lock struct(s), heap size 1136, 1 row lock(s)
-- MySQL thread id 55362, OS thread handle 23429547710208, query id 3924881837 172.31.0.246 admin updating
-- delete from `UnionGlobal`.`tblFavStore` where (`UnionGlobal`.`tblFavStore`.`userNo` = 10225 and `UnionGlobal`.`tblFavStore`.`storeNo` = 9)
--                                                   *** (1) WAITING FOR THIS LOCK TO BE GRANTED:
-- RECORD LOCKS space id 71 page no 6 n bits 472 index PRIMARY of table `UnionGlobal`.`tblFavStore` trx id 8936250 lock_mode X locks rec but not gap waiting
-- Record lock, heap no 152 PHYSICAL RECORD: n_fields 5; compact format; info bits 32
--  0: len 8; hex 8000000000000009; asc         ;;
-- 1: len 8; hex 80000000000027f1; asc       ' ;;
--  2: len 6; hex 000000885b38; asc     [8;;
--  3: len 7; hex 73000002a81114; asc s      ;;
--  4: len 5; hex 99b3988874; asc     t;;
-- 
-- *** (2) TRANSACTION:
-- TRANSACTION 8936249, ACTIVE 1 sec inserting
-- mysql tables in use 1, locked 1
-- 3 lock struct(s), heap size 1136, 2 row lock(s)
-- MySQL thread id 55363, OS thread handle 23428047238912, query id 3924881814 172.31.0.246 admin update
-- insert into `UnionGlobal`.`tblFavStore` (`userNo`, `storeNo`) values (10225, 9)
-- *** (2) HOLDS THE LOCK(S):
-- RECORD LOCKS space id 71 page no 6 n bits 472 index PRIMARY of table `UnionGlobal`.`tblFavStore` trx id 8936249 lock mode S locks rec but not gap
-- Record lock, heap no 152 PHYSICAL RECORD: n_fields 5; compact format; info bits 32
--  0: len 8; hex 8000000000000009; asc         ;;
--  1: len 8; hex 80000000000027f1; asc       ' ;;
-- 2: len 6; hex 000000885b38; asc     [8;;
-- 3: len 7; hex 73000002a81114; asc s      ;;
-- 4: len 5; hex 99b3988874; asc     t;;
-- 
-- *** (2) WAITING FOR THIS LOCK TO BE GRANTED:
-- RECORD LOCKS space id 71 page no 6 n bits 472 index PRIMARY of table `UnionGlobal`.`tblFavStore` trx id 8936249 lock_mode X locks rec but not gap waiting
-- Record lock, heap no 152 PHYSICAL RECORD: n_fields 5; compact format; info bits 32
--  0: len 8; hex 8000000000000009; asc         ;;
-- 1: len 8; hex 80000000000027f1; asc       ' ;;
--  2: len 6; hex 000000885b38; asc     [8;;
--  3: len 7; hex 73000002a81114; asc s      ;;
--  4: len 5; hex 99b3988874; asc     t;;
-- 
-- *** WE ROLL BACK TRANSACTION (1)
-- ------------
-- TRANSACTIONS
-- ------------
-- Trx id counter 10056749
-- Purge done for trx's n:o < 10056745 undo n:o < 0 state: running but idle
-- History list length 15
-- LIST OF TRANSACTIONS FOR EACH SESSION:
-- ---TRANSACTION 304904310623872, not started
-- 0 lock struct(s), heap size 1136, 0 row lock(s)
-- ---TRANSACTION 304904310627552, not started
-- 0 lock struct(s), heap size 1136, 0 row lock(s)
-- ---TRANSACTION 304904310626632, not started
-- 0 lock struct(s), heap size 1136, 0 row lock(s)
-- ---TRANSACTION 304904310633992, not started
-- 0 lock struct(s), heap size 1136, 0 row lock(s)
-- ---TRANSACTION 304904310632152, not started
-- 0 lock struct(s), heap size 1136, 0 row lock(s)
-- ---TRANSACTION 304904310631232, not started
-- 0 lock struct(s), heap size 1136, 0 row lock(s)
-- ---TRANSACTION 304904310630312, not started
-- 0 lock struct(s), heap size 1136, 0 row lock(s)
-- ---TRANSACTION 304904310624792, not started
-- 0 lock struct(s), heap size 1136, 0 row lock(s)
-- ---TRANSACTION 304904310628472, not started
-- 0 lock struct(s), heap size 1136, 0 row lock(s)
-- ---TRANSACTION 304904310625712, not started
-- 0 lock struct(s), heap size 1136, 0 row lock(s)
-- ---TRANSACTION 304904310622032, not started
-- 0 lock struct(s), heap size 1136, 0 row lock(s)
-- ---TRANSACTION 304904310622952, not started
-- 0 lock struct(s), heap size 1136, 0 row lock(s)
-- --------
-- FILE I/O
-- --------
-- I/O thread 0 state: waiting for completed aio requests (insert buffer thread)
-- I/O thread 1 state: waiting for completed aio requests (log thread)
-- I/O thread 2 state: waiting for completed aio requests (read thread)
-- I/O thread 3 state: waiting for completed aio requests (read thread)
-- I/O thread 4 state: waiting for completed aio requests (read thread)
-- I/O thread 5 state: waiting for completed aio requests (read thread)
-- I/O thread 6 state: waiting for completed aio requests (write thread)
-- I/O thread 7 state: waiting for completed aio requests (write thread)
-- I/O thread 8 state: waiting for completed aio requests (write thread)
-- I/O thread 9 state: waiting for completed aio requests (write thread)
-- Pending normal aio reads: [0, 0, 0, 0] , aio writes: [0, 0, 0, 0] ,
--  ibuf aio reads:, log i/o's:, sync i/o's:
-- Pending flushes (fsync) log: 0; buffer pool: 0
-- 19186 OS file reads, 10446722 OS file writes, 2234273 OS fsyncs
-- 0.00 reads/s, 0 avg bytes/read, 0.49 writes/s, 0.49 fsyncs/s
-- -------------------------------------
-- INSERT BUFFER AND ADAPTIVE HASH INDEX
--     -------------------------------------
--     Ibuf: size 1, free list len 0, seg size 2, 311 merges
--     merged operations:
-- insert 351, delete mark 95, delete 0
--     discarded operations:
-- insert 0, delete mark 0, delete 0
--     Hash table size 553253, node heap has 630 buffer(s)
--     Hash table size 553253, node heap has 109 buffer(s)
--     Hash table size 553253, node heap has 296 buffer(s)
--     Hash table size 553253, node heap has 228 buffer(s)
--     Hash table size 553253, node heap has 1049 buffer(s)
--     Hash table size 553253, node heap has 466 buffer(s)
--     Hash table size 553253, node heap has 319 buffer(s)
--     Hash table size 553253, node heap has 183 buffer(s)
--     16701.18 hash searches/s, 654.84 non-hash searches/s
--     ---
--     LOG
--     ---
--     Log sequence number 3158867205
--     Log flushed up to   3158867205
--     Pages flushed up to 3157705365
--     Last checkpoint at  3157705365
--     0 pending log flushes, 0 pending chkp writes
--     2069291 log i/o's done, 0.49 log i/o's/second
--     ----------------------
--     BUFFER POOL AND MEMORY
--     ----------------------
--     Total large memory allocated 2198863872
--     Dictionary memory allocated 665854
--     Buffer pool size   131072
--     Free buffers       55260
--     Database pages     72523
--     Old database pages 26606
--     Modified db pages  44053
--     Pending reads      0
--     Pending writes: LRU 0, flush list 0, single page 0
--     Pages made young 909, not young 0
--     0.00 youngs/s, 0.00 non-youngs/s
--     Pages read 18675, created 53848, written 8316636
--     0.00 reads/s, 0.00 creates/s, 0.00 writes/s
--     Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
--     Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
--     LRU len: 72523, unzip_LRU len: 0
--     I/O sum[0]:cur[0], unzip sum[0]:cur[0]
--     ----------------------
--     INDIVIDUAL BUFFER POOL INFO
--     ----------------------
--     ---BUFFER POOL 0
--     Buffer pool size   16384
--     Free buffers       6854
--     Database pages     9112
--     Old database pages 3343
--     Modified db pages  5534
--     Pending reads      0
--     Pending writes: LRU 0, flush list 0, single page 0
--     Pages made young 156, not young 0
--     0.00 youngs/s, 0.00 non-youngs/s
--     Pages read 2289, created 6823, written 1041946
--     0.00 reads/s, 0.00 creates/s, 0.00 writes/s
--     Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
--     Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
--     LRU len: 9112, unzip_LRU len: 0
--     I/O sum[0]:cur[0], unzip sum[0]:cur[0]
--     ---BUFFER POOL 1
--     Buffer pool size   16384
--     Free buffers       6989
--     Database pages     9004
--     Old database pages 3303
--     Modified db pages  5405
--     Pending reads      0
--     Pending writes: LRU 0, flush list 0, single page 0
--     Pages made young 120, not young 0
--     0.00 youngs/s, 0.00 non-youngs/s
--     Pages read 2487, created 6517, written 1038182
--     0.00 reads/s, 0.00 creates/s, 0.00 writes/s
--     Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
--     Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
--     LRU len: 9004, unzip_LRU len: 0
--     I/O sum[0]:cur[0], unzip sum[0]:cur[0]
--     ---BUFFER POOL 2
--     Buffer pool size   16384
--     Free buffers       7012
--     Database pages     8952
--     Old database pages 3284
--     Modified db pages  5470
--     Pending reads      0
--     Pending writes: LRU 0, flush list 0, single page 0
--     Pages made young 35, not young 0
--     0.00 youngs/s, 0.00 non-youngs/s
--     Pages read 2523, created 6429, written 1065175
--     0.00 reads/s, 0.00 creates/s, 0.00 writes/s
--     Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
--     Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
--     LRU len: 8952, unzip_LRU len: 0
--     I/O sum[0]:cur[0], unzip sum[0]:cur[0]
--     ---BUFFER POOL 3
--     Buffer pool size   16384
--     Free buffers       6942
--     Database pages     9015
--     Old database pages 3307
--     Modified db pages  5610
--     Pending reads      0
--     Pending writes: LRU 0, flush list 0, single page 0
--     Pages made young 166, not young 0
--     0.00 youngs/s, 0.00 non-youngs/s
--     Pages read 2318, created 6697, written 1045610
--     0.00 reads/s, 0.00 creates/s, 0.00 writes/s
--     Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
--     Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
--     LRU len: 9015, unzip_LRU len: 0
--     I/O sum[0]:cur[0], unzip sum[0]:cur[0]
--     ---BUFFER POOL 4
--     Buffer pool size   16384
--     Free buffers       6778
--     Database pages     9194
--     Old database pages 3373
--     Modified db pages  5528
--     Pending reads      0
--     Pending writes: LRU 0, flush list 0, single page 0
--     Pages made young 95, not young 0
--     0.00 youngs/s, 0.00 non-youngs/s
--     Pages read 2373, created 6821, written 1037406
--     0.00 reads/s, 0.00 creates/s, 0.00 writes/s
--     Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
--     Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
--     LRU len: 9194, unzip_LRU len: 0
--     I/O sum[0]:cur[0], unzip sum[0]:cur[0]
--     ---BUFFER POOL 5
--     Buffer pool size   16384
--     Free buffers       6838
--     Database pages     9137
--     Old database pages 3352
--     Modified db pages  5527
--     Pending reads      0
--     Pending writes: LRU 0, flush list 0, single page 0
--     Pages made young 109, not young 0
--     0.00 youngs/s, 0.00 non-youngs/s
--     Pages read 2260, created 6877, written 1032166
--     0.00 reads/s, 0.00 creates/s, 0.00 writes/s
--     Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
--     Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
--     LRU len: 9137, unzip_LRU len: 0
--     I/O sum[0]:cur[0], unzip sum[0]:cur[0]
--     ---BUFFER POOL 6
--     Buffer pool size   16384
--     Free buffers       6775
--     Database pages     9174
--     Old database pages 3366
--     Modified db pages  5502
--     Pending reads      0
--     Pending writes: LRU 0, flush list 0, single page 0
--     Pages made young 100, not young 0
--     0.00 youngs/s, 0.00 non-youngs/s
--     Pages read 2363, created 6811, written 1031449
--     0.00 reads/s, 0.00 creates/s, 0.00 writes/s
--     Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
--     Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
--     LRU len: 9174, unzip_LRU len: 0
--     I/O sum[0]:cur[0], unzip sum[0]:cur[0]
--     ---BUFFER POOL 7
--     Buffer pool size   16384
--     Free buffers       7072
--     Database pages     8935
--     Old database pages 3278
--     Modified db pages  5477
--     Pending reads      0
--     Pending writes: LRU 0, flush list 0, single page 0
--     Pages made young 128, not young 0
--     0.00 youngs/s, 0.00 non-youngs/s
--     Pages read 2062, created 6873, written 1024702
--     0.00 reads/s, 0.00 creates/s, 0.00 writes/s
--     Buffer pool hit rate 1000 / 1000, young-making rate 0 / 1000 not 0 / 1000
--     Pages read ahead 0.00/s, evicted without access 0.00/s, Random read ahead 0.00/s
--     LRU len: 8935, unzip_LRU len: 0
--     I/O sum[0]:cur[0], unzip sum[0]:cur[0]
--     --------------
--     ROW OPERATIONS
--     --------------
--     0 queries inside InnoDB, 0 queries in queue
--     0 read views open inside InnoDB
--     Process ID=539, Main thread ID=23426836190976, state: sleeping
--     Number of rows inserted 1980097089, updated 5115890, deleted 202267485, read 909820273470
--     192.63 inserts/s, 0.15 updates/s, 35.27 deletes/s, 27091.34 reads/s
--     ----------------------------
--     END OF INNODB MONITOR OUTPUT
--     ============================
-- 
```
