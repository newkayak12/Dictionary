# 인덱스

역시 다른 DB와 같이 인덱스를 생성하는게 보통이다. mongo에서 인덱스는 `1) 단순(simple) 인덱스`, `2) 복합(compound) 인덱스` 가 있다.

1. 단순 인덱스 : 단순 하나의 요소만 잡은 인덱스다. 
2. 복합 인덱스 : 여러 요소를 하나의 키로 묶은 인덱스다. 쿼리당 하나의 인덱스만 사용할 수 있기에 인덱스를 두 개 이상의 필드에 태우려면 필요하다. 또한 선언 순서가 중요하다.


## 효율
쿼리 성능을 위해서는 인덱스가 반드시 필요하지만 인덱스에는 유지 비용이 들어간다. 도큐먼트를 추가할 때마다 컬렉션에 생성된 인덱스도 새로운 도큐먼트를 포함시켜야 한다.
물론 읽기 위주라면 감당할 수 있는 비용이고 상쇄할 수 있다. 문제는 인덱스가 적합하더라도 메모리에 다 올리지 못해서 페이지 폴트가 생길 때 문제다.
램에 없어서 가지러 들어가고 올려놓고를 반복한다. 위와 같은 상황을 `Threshing`이라고 한다. 그래서 인덱스를 너무 많이 작성하는 것도 그리 바람직하지 않다.

 
## B-Tree
Mongo index도 B-Tree다. 트리 유사한 구조로 키의 삭제, 추가에 따라 밸런싱을 한다. 또한 일치, 범위, 정렬, 전방일치 등을 용이하게 할 수 있다.

## 타입
1. unique : 인덱스의 카디널리티가 높다. 선택도가 1이다. (선택도 = 카디널리티 / 전체 레코드 수)

```javascript
db.users.createIndex({userName:1}, {unique:true, dropDups: true}) //삭제 명령도 내릴 수 있다.
```

2. 희소 인덱스 vs. 밀집 인덱스

- 희소 인덱스 : 인덱스는 레코드 포인터를 갖는데 같은 인덱스를 가진 레코드들 중 첫 번째 만 갖고 있는 것을 의미한다. 클러스터링 인덱스에서 사용할 수 있다.
- 밀집 인덱스 : 인덱스는 레코드 포인터를 갖는데 같은 인덱스를 가진 레코드들의 레코드 포인터를 하나씩 모두 갖고 있는 경우를 밀집 인덱스라고 한다. 넌클러스터링 


## 생성
```javascript
db.target.createIndex({name: 1}, {background: 1}) //1 : asc, -1 : desc

```