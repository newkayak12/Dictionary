## 테스트 코드란?
### 테스트 코드 작성 이유

1. **기능 동작 여부를 검증하기 위함입니다.**  
    - 매 번 사람이 직접 테스트 하면 테스트 시나리오 검증을 누락할 수도 있으며, 테스트 과정에서 인지 편향이 발생하여 유의미한 테스트 결과를 얻지 못할 수도 있습니다.  
    - PR 생성 시 파이프라인을 통해서 자동으로 로직을 검증할 수 있습니다.
    
2. **코드 변경 시 사이드 이펙트를 조기에 발견할 수 있습니다.**  
    - 리팩토링, 기능 추가, 버그 수정 시 테스트 깨짐으로 사이드 이펙트를 조기에 발견할 수 있습니다.
    
3. **설계 품질이 상승합니다.**  
    - 테스트가 어려운 코드는 구조적으로 개선이 필요한 코드이므로 설계에 대한 피드백을 간접적으로 받을 수 있습니다.
    
4. **문서화를 할 수 있습니다.**  
    - 잘 설계된 테스트 코드는 ‘살아있는 문서’의 역할을 할 수 있습니다.
    

### 테스트 코드 작성 대상

#### ✅ 테스트 코드 작성 대상인 경우

1. **비즈니스 로직 :** 계산, 검증, 정책/ 규칙 등이 수반되는 경우 테스트 코드를 작성해서 검증해야 합니다.
    
2. **데이터 변환/ 유틸리지 로직:** 문자열 파싱, 수학 함수 등 작지만 오류 발생 시 영향도가 큰 경우 테스트 코드를 작성하여 오류를 미연에 방지해야 합니다.
    
3. **API Handler:** Request, Response 형태가 제대로 구성되는지, 일부 제약 조건들이 정상적으로 동작하는지 검증할 필요가 있는 경우 테스트 코드를 작성해야 합니다.
    

#### ❌ 테스트 코드 작성 대상이 아닌 경우

1. 이미 검증된 API: Java에서 제공하고 있는 API 등은 이미 충분히 검증됐으므로 테스트 대상에서 제외해야 합니다.
    
2. 단순 getter/ setter 
    

### 테스트 방법

1. **BDD(Behavior-Driven Development)**  
    - 기능을 사용자 입장에서 보고, 그 과정을 테스트로 만든 개발 방식입니다.  
    - Given - When - Then의 형식으로 작성합니다.
    

|       |                |
| ----- | -------------- |
| Given | 상황이 주어지고       |
| When  | 어떤 행등을 했을 때    |
| Then  | 기대되는 결과가 도출된다. |

- Scenario: 사용자가 주문을 수집한다.
    
    - Given: 셀러가 로그인한 상태고
        
    - When: 주문 수집을 요청하면
        
    - Then: 쇼핑몰에 누적된 주문 내역을 가져와서 노출해야 한다.


----
## JUnit

|       Annotation       |                                                            Description                                                             |            |                               |
| :--------------------: | :--------------------------------------------------------------------------------------------------------------------------------: | ---------- | ----------------------------- |
|         @Test          |                                                        메소드가 테스트 메소드임을 나타낸다.                                                        |            |                               |
|   @ParameterizedTest   |                                                        매개변수가 있는 테스트임을 나타낸다.                                                        |            |                               |
|      @ValueSource      |                                         반복 테스트에서 지정한 배열을 파라미터 값으로 순서대로 넘겨준다. (하나의 인수일 경우)                                          |            |                               |
|      @NullSource       |                                                       Null로 값을 전달할 떄  사용한다.                                                        |            |                               |
|      @EmptySource      |                                                        빈 값을 인수로 전달할 때 사용한다.                                                        |            |                               |
|  @NullAndEmptySource   |                                                      Null, Empty 모두 전달할 때 사용                                                       | @CsvSource | 테스트 입력값을 Csv로 구성하여 던질 떄 사용한다. |
|      @EnumSource       |                                                        열거형의 배열을 테스트 메소드에 전달                                                        |            |                               |
|     @MethodSource      |                                 Arguments로 파라미터를 여러 개 전달할 떄 사용한다. (Arguments.of(value, value....))                                 |            |                               |
|     @RepeatedTest      |                                                      메소드가 반복 테스트 메소드임을 나타낸다.                                                       |            |                               |
|      @DisplayName      |                                                  테스트 클래스 또는 메소드에 대한 사용자 지정 표시 이름                                                   |            |                               |
| @DisplayNameGeneration |                                                      테스트 클래스 이름 생성기를 선언한다. *                                                       |            |                               |
|      @BeforeEach       |   @Test, @RepeatedTest, @ParameterizedTest, @TestFactor 전에 실행되는 것을 나타낸다. <br/>테스트 마다 실행 전에 실행된다. <br/> 매 테스트마다 초기화해야 하는 경우 사용된다.   |            |                               |
|       @AfterEach       | @Test, @RepeatedTest, @ParameterizedTest, @TestFactor 후에 실행되는 것을 나타낸다.  <br/>테스트 마다 실행 후에 실행된다.     <br/> 매 테스트 후 정리해야 하는 경우 사용된다. |            |                               |
|       @BeforeAll       |                                     @BeforeEach 와 유사하지만 `static` 메소드여야만 하며  테스트 전에 한 번만 실행된다.                                      |            |                               |
|       @AfterAll        |                                      @AfterEach 와 유사하지만 `static` 메소드여야만 하며  테스트 후에 한 번만 실행된다.                                      |            |                               |
|        @Nested         |                                                   주석이 달린 클래스가 중첩 테스트 클래스임을 나타낸다.                                                   |            |                               |
|          @Tag          |                                                   클래스, 메소드 수준 테스트 필터링을 위해서 사용한다.                                                   |            |                               |
|       @Disabled        |                                                    테스트 클래스, 메소드를 비활성화할 때 사용한다.                                                     |            |                               |
|        @Timeout        |                                                          테스트 타임아웃을 지정한다.                                                           |            |                               |
|      @ExtendWith       |                                                       확장을 선언적으로 등록할 때 사용한다.                                                        |            |                               |
|   @RegisterExtension   |                                                 필드를 통해 프로그래밍 방식으로 확장을 등록할 떄 사용한다.                                                  |            |                               |
|        @TempDir        |                                             테스트 메소드에서 필드 주입 또는 매개변수 주입을 통해 임시 디렉토리를 제공                                             |            |                               |
|      @TestFactory      |                                                     동적 테스트를 위한 테스트 팩토리임을 나타낸다.                                                     |            |                               |
|     @TestTemplate      |                                                                                                                                    |            |                               |
|    @TestClassOrder     |                                                   @Nested 간 실행 순서를 구성하는 데 사용한다.                                                    |            |                               |
|    @TestMethodOrder    |                             테스트 메소드간 순서를 구성하는 데 사용한다.                                               @                              |            |                               |
|     @TestInstance      |                                              주석이 달린 테스트 클래스의 인스턴스 수명 주기를 구성하는데 사용한다.                                               |            |                               |
|          @Sql          |                                             sql 파일을 지정하여 Dao 단위 테스트에 미리 구성된 쿼리를 실행한다.                                              |            |                               |

----

## Assertions 
**테스트 코드에서 실제 실행 결과가 내가 기대한 결과와 같은지 확인하는 도구**

| Assertion 메소드                           |      설명       |
| :-------------------------------------- | :-----------: |
| assertEquals(expected, actual)          |   두 값이 같은지    |
| assertNotEquals(5, count)               |  두 값이 달라야 함   |
| assertTrue(condition)                   |  조건이 true인지   |
| assertFalse(condition)                  |  조건이 false인지  |
| assertNull(value)                       |    null인지     |
| assertNotNull(value)                    |   null이 아닌지   |
| assertSame(expected, actual)            |   같은 인스턴스인지   |
| assertNotSame(expected, actual)         |   다른 인스턴스인지   |
| assertArrayEquals(expected[], actual[]) |    배열이 같은지    |
| assertThrows(Exception.class, 실행문)      | 특정 예외가 발생해야 함 |
| assertDoesNotThrow(실행문)                 | 예외가 발생하면 안 됨  |

## Mockito

트하기 어려운 외부 의존성을 Mock(모킹)으로 대체하면, **순수한 비즈니스 로직만 집중**해서 테스트할 수 있습니다.

Mock(모킹)이란, 테스트하려는 코드가 외부 시스템이나 객체를 **실제로 사용하지 않고**, 대신 **‘가짜 객체’**를 만들어 테스트하는 방법입니다.

이를 통해 데이터베이스 연결이나 여러 객체를 실제로 만들고 원하는 동작을 설정하는 **번거로움을 줄일 수** 있습니다.


### Annotation

| **어노테이션**                          | **용도**                                               |
| --------------------------------------- | ------------------------------------------------------ |
| **@Mock**                               | 테스트 대상 클래스가 의존하는 **가짜 객체(Mock)** 생성 |
| **@InjectMocks**                        | Mock 객체를 테스트 대상 객체에 **주입**                |
| **@Spy**                                | 실제 객체를 사용하되, 특정 메서드만 Mock 가능          |
| **@Captor**                             | Mockito에서 ArgumentCaptor를 선언할 때 사용            |
| **@ExtendWith(MockitoExtension.class)** | JUnit5에서 Mockito 사용을 위해 필요                    |

### Methods

| **메서드**                              | **용도**                 |
| ------------------------------------ | ---------------------- |
| **when(…).thenReturn(…)**            | 특정 메서드 호출 시 **결과값 지정** |
| **when(…).thenThrow(…)**             | 특정 메서드 호출 시 **예외 발생**  |
| **verify(mock, times(n)).method(…)** | 메서드 **호출 여부/횟수 확인**    |
| **any() / anyString() / anyLong()**  | 어떤 값이 들어와도 허용          |
| **doReturn(…).when(mock).method(…)** | spy 객체에서 반환값 지정        |
| **doThrow(…).when(mock).method(…)**  | spy 객체에서 예외 발생 지정      |
| **ArgumentCaptor.capture()**         | =메서드 호출 시 인자 값을 **캡처** |

## BDDMockito
| **메서드**                            | **역할**                                |
| ---------------------------------- | ------------------------------------- |
| **given(…)**                       | Mock 객체의 동작을 설정할 때 사용 (Mockito의 when) |
| **willReturn(…)**                  | 주어진 상황에서 반환값 지정                       |
| **willThrow(…)**                   | 주어진 상황에서 예외 던지기                       |
| **then(…)**                        | Mock 호출 검증 시작 (Mockito의 verify)       |
| **should()**                       | Mock가 호출되었는지 검증                       |
| **should(times(n))**               | Mock 호출 횟수 검증                         |
| **shouldHaveNoInteractions(mock)** | Mock가 호출되지 않았음을 검증                    |
| **willAnswer(…)**                  | 동적 응답(람다 등)을 설정                       |


## Extension
1. **MockitoExtension**: Mockito와 JUnit을 연결해줍니다.
	1. @Mock으로 선언한 객체 초기화
	2. @InjectMocks로 대상 객체에 Mock 주입
2. **SpringExtension**: Spring과 JUnit을 연결해줍니다.
	1. Spring 컨텍스트를 초기화하고,
	2. @Autowired나 @Value 같은 의존성 주입을 처리하고,
    3. @Transactional, @TestPropertySource 등 Spring 테스트 관련 기능을 지원합니다.